{
  "name": "Telegram Movie Chatbot",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "id": "telegram-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [250, 300],
      "webhookId": "movie-bot-webhook"
    },
    {
      "parameters": {
        "rules": {
          "rules": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "start"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/phimhay",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "phimhay"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/rapchieu",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "rapchieu"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/timphim",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "timphim"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": false,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/help",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "help"
            }
          ]
        },
        "options": {}
      },
      "id": "switch-command",
      "name": "Switch Command",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [500, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.themoviedb.org/3/movie/now_playing",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "api_key",
              "value": "={{ $credentials.tmdbApi.apiKey }}"
            },
            {
              "name": "language",
              "value": "vi-VN"
            },
            {
              "name": "region",
              "value": "VN"
            }
          ]
        },
        "options": {}
      },
      "id": "get-movies",
      "name": "Get Now Playing Movies",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [750, 200]
    },
    {
      "parameters": {
        "jsCode": "const movies = $input.first().json.results.slice(0, 5);\n\nlet message = \"üé¨ *TOP PHIM HAY ƒêANG CHI·∫æU*\\n\\n\";\n\nmovies.forEach((movie, index) => {\n  message += `${index + 1}. *${movie.title}*\\n`;\n  message += `   ‚≠ê ƒêi·ªÉm: ${movie.vote_average.toFixed(1)}/10\\n`;\n  message += `   üìÖ Kh·ªüi chi·∫øu: ${movie.release_date}\\n`;\n  if (movie.overview) {\n    const shortOverview = movie.overview.substring(0, 100) + (movie.overview.length > 100 ? '...' : '');\n    message += `   üìù ${shortOverview}\\n`;\n  }\n  message += `\\n`;\n});\n\nmessage += \"\\nüí° G√µ /timphim [t√™n phim] ƒë·ªÉ xem chi ti·∫øt\";\n\nreturn [{ json: { text: message } }];"
      },
      "id": "format-movies",
      "name": "Format Movie List",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1000, 200]
    },
    {
      "parameters": {
        "jsCode": "const message = `üé¨ *CH√ÄO M·ª™NG ƒê·∫æN V·ªöI MOVIE BOT*\n\nT√¥i c√≥ th·ªÉ gi√∫p b·∫°n:\n\nüìΩÔ∏è /phimhay - Xem top phim hay ƒëang chi·∫øu\nüè¢ /rapchieu - T√¨m r·∫°p chi·∫øu phim g·∫ßn b·∫°n\nüîç /timphim [t√™n] - T√¨m ki·∫øm th√¥ng tin phim\n‚ùì /help - Xem h∆∞·ªõng d·∫´n\n\n*H√£y b·∫Øt ƒë·∫ßu th√¥i n√†o!* üçø`;\n\nreturn [{ json: { text: message } }];"
      },
      "id": "welcome-message",
      "name": "Welcome Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [750, 50]
    },
    {
      "parameters": {
        "jsCode": "const message = `üìñ *H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG*\n\n*C√°c l·ªánh c√≥ s·∫µn:*\n\n1Ô∏è‚É£ /phimhay\n   ‚Üí Xem danh s√°ch phim hay ƒëang chi·∫øu\n\n2Ô∏è‚É£ /rapchieu\n   ‚Üí T√¨m r·∫°p chi·∫øu phim g·∫ßn b·∫°n\n   ‚Üí G·ª≠i v·ªã tr√≠ ƒë·ªÉ t√¨m ch√≠nh x√°c h∆°n\n\n3Ô∏è‚É£ /timphim [t√™n phim]\n   ‚Üí V√≠ d·ª•: /timphim Avengers\n   ‚Üí T√¨m ki·∫øm th√¥ng tin chi ti·∫øt v·ªÅ phim\n\n4Ô∏è‚É£ /help\n   ‚Üí Xem l·∫°i h∆∞·ªõng d·∫´n n√†y\n\nüí° *M·∫πo:* B·∫°n c√≥ th·ªÉ g·ª≠i t√™n phim tr·ª±c ti·∫øp ƒë·ªÉ t√¨m ki·∫øm nhanh!`;\n\nreturn [{ json: { text: message } }];"
      },
      "id": "help-message",
      "name": "Help Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [750, 500]
    },
    {
      "parameters": {
        "jsCode": "const userMessage = $('Telegram Trigger').item.json.message.text;\nconst movieName = userMessage.replace('/timphim', '').trim();\n\nif (!movieName) {\n  return [{ json: { error: true, text: '‚ùå Vui l√≤ng nh·∫≠p t√™n phim\\n\\nV√≠ d·ª•: /timphim Avengers' } }];\n}\n\nreturn [{ json: { movieName: movieName } }];"
      },
      "id": "extract-movie-name",
      "name": "Extract Movie Name",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [750, 350]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-error",
              "leftValue": "={{ $json.error }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "if-error",
      "name": "IF Error",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1000, 350]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://api.themoviedb.org/3/search/movie",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "api_key",
              "value": "={{ $credentials.tmdbApi.apiKey }}"
            },
            {
              "name": "language",
              "value": "vi-VN"
            },
            {
              "name": "query",
              "value": "={{ $json.movieName }}"
            }
          ]
        },
        "options": {}
      },
      "id": "search-movie",
      "name": "Search Movie",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1250, 400]
    },
    {
      "parameters": {
        "jsCode": "const results = $input.first().json.results;\n\nif (!results || results.length === 0) {\n  return [{ json: { text: '‚ùå Kh√¥ng t√¨m th·∫•y phim n√†o\\n\\nH√£y th·ª≠ t√¨m v·ªõi t·ª´ kh√≥a kh√°c!' } }];\n}\n\nconst movie = results[0];\nlet message = `üé¨ *${movie.title}*\\n`;\n\nif (movie.original_title !== movie.title) {\n  message += `(${movie.original_title})\\n`;\n}\n\nmessage += `\\n‚≠ê *ƒêi·ªÉm ƒë√°nh gi√°:* ${movie.vote_average.toFixed(1)}/10`;\nmessage += `\\nüë• *L∆∞·ª£t vote:* ${movie.vote_count.toLocaleString()}`;\nmessage += `\\nüìÖ *Ng√†y ph√°t h√†nh:* ${movie.release_date || 'Ch∆∞a x√°c ƒë·ªãnh'}`;\nmessage += `\\nüé≠ *D√†nh cho ng∆∞·ªùi l·ªõn:* ${movie.adult ? 'C√≥' : 'Kh√¥ng'}`;\n\nif (movie.overview) {\n  message += `\\n\\nüìù *N·ªôi dung:*\\n${movie.overview}`;\n}\n\nif (movie.poster_path) {\n  message += `\\n\\nüñºÔ∏è [Xem poster](https://image.tmdb.org/t/p/w500${movie.poster_path})`;\n}\n\nmessage += `\\n\\nüí° G√µ /rapchieu ƒë·ªÉ t√¨m r·∫°p chi·∫øu g·∫ßn b·∫°n!`;\n\nreturn [{ json: { text: message } }];"
      },
      "id": "format-search-result",
      "name": "Format Search Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 400]
    },
    {
      "parameters": {
        "jsCode": "const cinemas = [\n  {\n    name: \"CGV Vincom Center\",\n    address: \"72 L√™ Th√°nh T√¥n, Q.1, TP.HCM\",\n    phone: \"1900 6017\"\n  },\n  {\n    name: \"Lotte Cinema Nam S√†i G√≤n\",\n    address: \"469 Nguy·ªÖn H·ªØu Th·ªç, Q.7, TP.HCM\",\n    phone: \"1900 6017\"\n  },\n  {\n    name: \"Galaxy Nguy·ªÖn Du\",\n    address: \"116 Nguy·ªÖn Du, Q.1, TP.HCM\",\n    phone: \"1900 2224\"\n  },\n  {\n    name: \"BHD Star Bitexco\",\n    address: \"L3&4, TTTM Icon 68, 2 H·∫£i Tri·ªÅu, Q.1, TP.HCM\",\n    phone: \"19002099\"\n  },\n  {\n    name: \"Cinestar Hai B√† Tr∆∞ng\",\n    address: \"271 Nguy·ªÖn Tr√£i, Q.1, TP.HCM\",\n    phone: \"028 3925 5255\"\n  }\n];\n\nlet message = \"üè¢ *DANH S√ÅCH R·∫†P CHI·∫æU PHIM*\\n\\n\";\n\ncinemas.forEach((cinema, index) => {\n  message += `${index + 1}. *${cinema.name}*\\n`;\n  message += `   üìç ${cinema.address}\\n`;\n  message += `   üìû ${cinema.phone}\\n\\n`;\n});\n\nmessage += \"üí° *M·∫πo:* G·ª≠i v·ªã tr√≠ c·ªßa b·∫°n ƒë·ªÉ t√¨m r·∫°p g·∫ßn nh·∫•t!\\n\";\nmessage += \"üé´ ƒê·∫∑t v√© tr·ª±c ti·∫øp t·∫°i website c·ªßa r·∫°p\";\n\nreturn [{ json: { text: message } }];"
      },
      "id": "cinema-list",
      "name": "Cinema List",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [750, 650]
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "telegram-send",
      "name": "Send Telegram Message",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.1,
      "position": [1750, 300]
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Command": {
      "main": [
        [
          {
            "node": "Welcome Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Now Playing Movies",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Cinema List",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Extract Movie Name",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Help Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Now Playing Movies": {
      "main": [
        [
          {
            "node": "Format Movie List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Movie List": {
      "main": [
        [
          {
            "node": "Send Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Welcome Message": {
      "main": [
        [
          {
            "node": "Send Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Help Message": {
      "main": [
        [
          {
            "node": "Send Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Movie Name": {
      "main": [
        [
          {
            "node": "IF Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Error": {
      "main": [
        [
          {
            "node": "Send Telegram Message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search Movie",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search Movie": {
      "main": [
        [
          {
            "node": "Format Search Result",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Search Result": {
      "main": [
        [
          {
            "node": "Send Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cinema List": {
      "main": [
        [
          {
            "node": "Send Telegram Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "telegram",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    },
    {
      "name": "movie",
      "createdAt": "2024-01-01T00:00:00.000Z",
      "updatedAt": "2024-01-01T00:00:00.000Z"
    }
  ],
  "triggerCount": 1,
  "pinData": {}
}
